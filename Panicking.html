<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.8.13" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>STX: $title</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="styles.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <script>
        /*
                // light mode, dark mode
                color: ["#333", "#DDD"],
                backgroundColor: ["#FFFFFF", "#353535"],
                cardBackgroundColor: ["#F5F5F5", "#2A2A2A"],
                linkColor: ["#3D578C", "#D2991D"],
                headerBackgroundColor: ["#F1F1F1", "#505050"],
                headerHoverBackgroundColor: ["#F5F5F5", "#444"],
                // memtitle, memproto, memitemleft, memitemright 
                docprotoBackgroundColor: ["#FAFAFA", "2A2A2A"]
        */
        function switchTheme() {
            let theme = localStorage.getItem("theme");
            if (theme == "light" || theme == null) {
                document.body.className = "dark-theme";
                localStorage.setItem("theme", "dark");
            } else {
                document.body.className = "";
                localStorage.setItem("theme", "light");
            }
        }
        (function loadTheme() {
            let theme = localStorage.getItem("theme");
            console.log("theme:" + theme);
            if (theme == "light" || theme == null) {
                document.body.className = "";
            } else {
                document.body.className = "dark-theme";
            }
        })();
    </script>
    <div class="theme-switch dimming-wrap" onclick="switchTheme()">
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 48 48">
                <path
                    d="M42 6H6c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h36c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zm0 32.03H6V9.97h36v28.06zM16 32h5l3 3 3-3h5v-5l3-3-3-3v-5h-5l-3-3-3 3h-5v5l-3 3 3 3v5zm8-14c3.31 0 6 2.69 6 6s-2.69 6-6 6V18z" />
            </svg></div>
    </div>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 56px;">
                        <td id="projectlogo"><img alt="Logo"
                                src="eagle.png" /></td>
                        <td id="projectalign" style="padding-left: 0.5em;">
                            <div id="projectname"> STX
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><h1>Panicking</h1>
<p>What is a panic?</p>
<p>Sometimes, bad things happen in your code, and there's nothing you can do about it. In these cases, STX has the <code><a class="el" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">panic()</a></code> function.</p>
<p>When the <code>panic</code> function executes, your program will print a provided failure message, and then abort. This most commonly occurs when a bug of some kind has been detected and it's not clear to the programmer how to handle the error.</p>
<p>Panics serve for communicating an unexpected flow or corrupted state of the program. Consequentially, panics represent an end-point for the program. Common irrecoverable errors include: heap memory exhaustion, invalid memory indexes, password/access errors.</p>
<p>Let's try calling <code><a class="el" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">panic()</a></code> in a simple program:</p>
<p>Filename: src/main.cc</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="panic_8h.html">stx/panic.h</a>&quot;</span></div><div class="line"></div><div class="line"> <span class="keywordtype">int</span> main() {</div><div class="line">    <a class="code" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">stx::panic</a>(<span class="stringliteral">&quot;crash and burn!&quot;</span>);</div><div class="line"> }</div></div><!-- fragment --><p>When you run the program, you'll see something like this:</p>
<div class="fragment"><div class="line">$ ./main.bin</div><div class="line"></div><div class="line"> thread with hash: &#39;15729502191765196471&#39; panicked with: &#39;crash and burn!&#39; at function: &#39;main&#39; [src/main.cc:5:1]</div><div class="line"> Aborted (core dumped)</div></div><!-- fragment --><p>The call to <code>panic</code> causes the error message. The second line shows our panic message and the place in our source code where the panic occurred: <code>src/main.cc:5:1</code> indicates that it's the fifth line, first character of our src/main.cc file.</p>
<p>In this case, the line indicated is part of our code, and if we go to that line, we see the <code>panic</code> function call.</p>
<p>In other cases, the <code>panic</code> call might be in code that our code calls, and the filename and line number reported by the error message will be someone else's code where the <code>panic</code> function is called, not the line of our code that eventually led to the <code>panic</code> call. We can use the backtrace of the functions the <code>panic</code> call came from to figure out the part of our code that is causing the problem. Backtraces can be enabled via your application CMakeLists.txt file by setting <code>STX_ENABLE_BACKTRACE</code> to <code>ON</code> .</p>
<h1>When to <a class="el" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">panic()</a> ?</h1>
<p>Panics should be used when there is no means for the program to recover from an error, or for absolutely unexpected / <b>exceptional</b> cases. For recoverrable errors, see: <code><a class="el" href="classstx_1_1Result.html">stx::Result</a></code> and <code><a class="el" href="classstx_1_1Option.html">stx::Option</a></code></p>
<p>When you choose to return a <code>Result</code> value, you give the calling code options rather than making the decision for it. The calling code could choose to attempt to recover in a way that's appropriate for its situation, or it could decide that an <code>Err</code> value in this case is unrecoverable, so it can call <code>panic</code> and turn your recoverable error into an unrecoverable one. Therefore, returning <code>Result</code> is a good default choice when you're defining a function that might fail.</p>
<h1>An Example</h1>
<p>Here is an example of using a panic with a malloc.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cinttypes&gt;</span></div><div class="line"><span class="preprocessor"> #include &lt;cstdlib&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor"> #include &quot;<a class="code" href="panic_8h.html">stx/panic.h</a>&quot;</span> </div><div class="line"></div><div class="line"> <span class="keywordtype">void</span> * make_memory(<span class="keywordtype">size_t</span> n) {</div><div class="line">    <span class="keyword">auto</span> memory = malloc(n);</div><div class="line">    <span class="keywordflow">if</span>(memory == <span class="keyword">nullptr</span>) <a class="code" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">stx::panic</a>(<span class="stringliteral">&quot;Memory Allocation Failure&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> memory;</div><div class="line"> }</div><div class="line"></div><div class="line"> <span class="keywordtype">int</span> main() {</div><div class="line">     <span class="comment">// panics if a memory allocation or heap exhaustion error occurs</span></div><div class="line">     <span class="keyword">auto</span> buffer = make_memory(1024);</div><div class="line">     free(buffer);</div><div class="line"> }</div></div><!-- fragment --><h1>Available Panic Handlers:</h1>
<p>Given that systems range from user-facing to safety-critical (cannot crash) there's no one size fits all panicking behavior but there are plenty of commonly used behaviors.</p>
<p>To define your panic handlers, we have provided a few behaviours for your use:</p>
<ul>
<li><code><a class="el" href="namespacestx.html#a1ebce27ece974208de2c36d2dc15c531">stx::panic_default</a></code> : The default panic handler that prints the error message and panic location data, and afterwards aborts the program without freeing the resources. If the backtrace feature is enabled, the panic function will also print a stack backtrace. In addition, this panic handler is thread-safe when reporting to <code>stderr</code> .</li>
<li><code><a class="el" href="namespacestx.html#ac12bc9b5d83367f67f863b8e1bfad0b4">stx::panic_halt</a></code> : A panic handler that causes the program, or the current thread, to halt by entering an infinite loop, Andrew Koenig generally advises halting on heap memory exhaustion.</li>
<li><code><a class="el" href="namespacestx.html#aa46f26a96cafe98167a3dd212bda8027" title="Causes the abort instruction to be executed. ">stx::panic_abort</a></code> : A panic handler that causes the abort instruction to be executed.</li>
</ul>
<h1>Overriding the default panic behaviour</h1>
<p>Suppose you want to log the errors to disk or to a network before terminating the program, you can define your custom panic handlers to do that.</p>
<p><b>NOTE</b>: A panic handler can only be defined once (One Definition Rule).</p>
<p>Firstly via your project's CMake build file, set the <code>STX_OVERRIDE_PANIC_HANDLER</code> option to <code>ON</code> , and then define the panic handler in your executable.</p>
<p>See the <a href="https://github.com/lamarrr/STX/examples"><code>panic_handler</code></a> example project that illustrates how to do this.</p>
<p>We can also call any of the provided panic handlers.</p>
<h1>Debugging Notes</h1>
<ul>
<li>For all calls to <code><a class="el" href="namespacestx.html#acf6af607fec2dc51a8fdb46f50585932">stx::panic</a></code> within a program, the panic handler will be called to handle the panic. You can set your debugging breakpoint to the <code><a class="el" href="namespacestx.html#a03a1b36ff7ba488963d26582d10616b2">stx::begin_panic</a></code> function to investigate all panics that occur within the program and also view a detailed backtrace.</li>
<li>You can optionally enable automatic backtraces on panics. See the <a href="(https://github.com/lamarrr/STX/examples)"><code>panic_backtrace</code></a> example project.</li>
</ul>
<h1>Implementation and Portability Notes</h1>
<ul>
<li>For printing/logging to <code>stderr</code> , the default panic handler only uses <code>fputs</code> and <code>fputc</code>.</li>
<li>To use <code>panic</code> with the default panic handler on embedded systems you need to have <code>fputs</code> , <code>fputc</code> , and <code>snprintf</code> implemented. If you are using a POSIX-compliant operating system like nano OS in GNU newlib nano which already fills them with stubs, you have to implement the <code>write</code> syscall to forward to <code>UART</code> or whatever hardware peripheral you want <code>stderr</code> 's characters to be forwarded to.</li>
<li><dl class="section see"><dt>See also</dt><dd><code><a class="el" href="classstx_1_1Result.html">stx::Result</a></code></dd></dl>
</li>
<li><dl class="section see"><dt>See also</dt><dd><code><a class="el" href="classstx_1_1Option.html">stx::Option</a></code> </dd></dl>
</li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer" />
<address class="footer"><small>
    Generated by &#160;<a href="http://www.doxygen.org/index.html"> Doxygen
    </a> 1.8.13
  </small></address>
<script type="text/javascript">
  (() => {
    document.body.onload = (() => {
      //
      //
      let clipboard_icon = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"\
      class="copy-icon dimming-wrap">\
      <path d="M0 0h24v24H0z"  fill="none"/>\
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 \
      2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>\
      </svg>';
      for (let x of document.querySelectorAll("div.fragment")) {
        if (x.querySelector(".lineno") == null)
          x.innerHTML = clipboard_icon + x.innerHTML;
      };
      for (let copy_icon of document.querySelectorAll(".copy-icon")) {
        copy_icon.onclick = () => {
          let code_content = "";
          for (let line of copy_icon.parentElement.querySelectorAll(".line")) {
            code_content = code_content.concat(line.textContent);
            code_content = code_content.concat("\n");
          }
          navigator.clipboard.writeText(code_content);
          alert("Copied to Clipboard");
        };
      };
    });
  })();
</script>
</body>
</html>